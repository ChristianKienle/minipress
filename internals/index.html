<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>miniPress</title><meta name="Description" content="Build Static Sites – super easy.">
    <link rel="preload" href="/minipress/style.css" as="style"><link rel="preload" href="/minipress/assets/js/app.js" as="script"><link rel="preload" href="/minipress/assets/js/13.js" as="script"><link rel="prefetch" href="/minipress/assets/js/1.js"><link rel="prefetch" href="/minipress/assets/js/10.js"><link rel="prefetch" href="/minipress/assets/js/11.js"><link rel="prefetch" href="/minipress/assets/js/12.js"><link rel="prefetch" href="/minipress/assets/js/14.js"><link rel="prefetch" href="/minipress/assets/js/15.js"><link rel="prefetch" href="/minipress/assets/js/16.js"><link rel="prefetch" href="/minipress/assets/js/17.js"><link rel="prefetch" href="/minipress/assets/js/18.js"><link rel="prefetch" href="/minipress/assets/js/19.js"><link rel="prefetch" href="/minipress/assets/js/2.js"><link rel="prefetch" href="/minipress/assets/js/20.js"><link rel="prefetch" href="/minipress/assets/js/21.js"><link rel="prefetch" href="/minipress/assets/js/22.js"><link rel="prefetch" href="/minipress/assets/js/23.js"><link rel="prefetch" href="/minipress/assets/js/24.js"><link rel="prefetch" href="/minipress/assets/js/25.js"><link rel="prefetch" href="/minipress/assets/js/26.js"><link rel="prefetch" href="/minipress/assets/js/27.js"><link rel="prefetch" href="/minipress/assets/js/28.js"><link rel="prefetch" href="/minipress/assets/js/3.js"><link rel="prefetch" href="/minipress/assets/js/4.js"><link rel="prefetch" href="/minipress/assets/js/5.js"><link rel="prefetch" href="/minipress/assets/js/6.js"><link rel="prefetch" href="/minipress/assets/js/7.js"><link rel="prefetch" href="/minipress/assets/js/8.js"><link rel="prefetch" href="/minipress/assets/js/9.js">
    <link rel="stylesheet" href="/minipress/style.css">
  </head>
  <body>
    <div data-server-rendered="true" id="app"><div class="page-content"><div class="mp-layout"><nav class="mp-nav mp-layout__nav" data-v-41fdbb3d><div style="align-items:center;justify-content:center;display:flex;" data-v-41fdbb3d><button class="button mp-main-sidebar-button" style="width:20px;height:20px;margin-right:10px;" data-v-011230cc><svg viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="mp-burger-icon" data-v-011230cc><foreignObject width="16" height="16"><svg><rect x="0.5" y="0.5" width="15" height="1" rx="0.5"></rect> <rect x="0.5" y="14.5" width="15" height="1" rx="0.5"></rect> <rect x="0.5" y="7.5" width="15" height="1" rx="0.5"></rect></svg></foreignObject></svg></button> <div class="mp-nav__product" data-v-41fdbb3d><a href="/minipress/" class="mp-nav__product__link"><span class="logo"><span class="logo__mini">mini</span><span>Press</span></span></a></div></div> <div class="mp-nav__items" data-v-41fdbb3d><div class="mp-nav__item" data-v-41fdbb3d><a href="/minipress/guide/" class="mp-nav__item__link">
      Guide
    </a></div><div class="mp-nav__item" data-v-41fdbb3d><a href="/minipress/configuration/" class="mp-nav__item__link">
      Configuration
    </a></div><div class="mp-nav__item" data-v-41fdbb3d><a href="/minipress/features/" class="mp-nav__item__link">
      Features
    </a></div><div class="mp-nav__item" data-v-41fdbb3d><a href="/minipress/themes/" class="mp-nav__item__link">
      Themes
    </a></div><div class="mp-nav__item" data-v-41fdbb3d><a href="/minipress/plugins/" class="mp-nav__item__link">
      Plugins
    </a></div><div class="mp-nav__item" data-v-41fdbb3d><a href="/minipress/404" class="mp-nav__item__link">
      GitHub
    </a></div></div></nav> <div class="mp-mask"></div> <div class="mp-layout__content"><div class="mp-sidebar"><div class="mp-left-bar mp-layout__left" data-v-1659774c><div data-v-1659774c><div class="navbar-items" data-v-1659774c><div data-toc-item-level="2" class="mp-toc__item"><a href="/minipress/guide/" class="mp-toc__item__link">
  Guide
</a></div><div data-toc-item-level="2" class="mp-toc__item"><a href="/minipress/configuration/" class="mp-toc__item__link">
  Configuration
</a></div><div data-toc-item-level="2" class="mp-toc__item"><a href="/minipress/features/" class="mp-toc__item__link">
  Features
</a></div><div data-toc-item-level="2" class="mp-toc__item"><a href="/minipress/themes/" class="mp-toc__item__link">
  Themes
</a></div><div data-toc-item-level="2" class="mp-toc__item"><a href="/minipress/plugins/" class="mp-toc__item__link">
  Plugins
</a></div><div data-toc-item-level="2" class="mp-toc__item"><a href="/minipress/404" class="mp-toc__item__link">
  GitHub
</a></div></div> <div data-toc-item-level="1" slug="internals" text="Internals" class="mp-toc__item">
    Internals
  </div> <div><div data-toc-item-level="2" class="mp-toc__item"><a href="/minipress/internals#how-pages-come-to-life" class="mp-toc__item__link">
  How Pages come to Life
</a></div><div data-toc-item-level="2" class="mp-toc__item"><a href="/minipress/internals#learnings" class="mp-toc__item__link">
  Learnings
</a></div><div data-toc-item-level="3" class="mp-toc__item"><a href="/minipress/internals#plugintheme-api" class="mp-toc__item__link">
  Plugin/Theme-API
</a></div><div data-toc-item-level="2" class="mp-toc__item"><a href="/minipress/internals#asyncdata" class="mp-toc__item__link">
  asyncData
</a></div></div> </div></div></div> <div class="mp-layout__container mp-layout__container--with-sidebar"><div class="mp-main__content" style="max-width:800px;"><div><div><h1 id="internals"><a href="/minipress/internals#internals" aria-hidden="true" class="header-anchor">#</a> Internals</h1> <p>If you want to know how <em>miniPress</em> works internally – this guide is for you.</p> <blockquote><p><strong>A word of caution:</strong>
The internals change very frequently as I learn new things. Also – my understanding might be incorrect.</p></blockquote> <h2 id="how-pages-come-to-life"><a href="/minipress/internals#how-pages-come-to-life" aria-hidden="true" class="header-anchor">#</a> How Pages come to Life</h2> <p>Let’s assume that there is a directory called <code>pages/</code>, which contains all of your Markdown files. Each file represents a page. When <em>miniPress</em> is started, it looks in that directory and finds all Markdown files. It makes a note of each file and basically just renders the Markdown file using it’s custom Markdown setup. So basically this is what happens (<em>pseudocode</em>):</p> <div class="minipress-highlight" data-lang="js"><pre class="minipress-highlight-code language-js"><code class="language-js"><span class="token keyword">const</span> paths <span class="token operator">=</span> <span class="token function">findPagesIn</span><span class="token punctuation">(</span><span class="token string">'pages/'</span><span class="token punctuation">)</span>
paths<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">path</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Page</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div><p>The Markdown pipeline is setup in a <strong>special way</strong>:</p> <ul><li><code>render()</code> does some preprocessing (extract frontmatter, …) and the renders the page by basically invoking each Markdown(-it)-plugin.</li> <li>Each Markdown plugin knows which <code>Page</code>-instance it operates on.</li> <li>Each Markdown plugin does it’s job and then simply sets properties on the page instance as needed.</li> <li>For example – the headings plugin sets the <code>headings</code>-property on the page instance.</li></ul> <p>After the <em>initial</em> render process the <code>Page</code>-instances are pre-populated with all the data we need.</p> <h2 id="learnings"><a href="/minipress/internals#learnings" aria-hidden="true" class="header-anchor">#</a> Learnings</h2> <h3 id="plugintheme-api"><a href="/minipress/internals#plugintheme-api" aria-hidden="true" class="header-anchor">#</a> Plugin/Theme-API</h3> <p>Originally I wanted to have a plugin-/theme-API like plugins in Rollup are done:</p> <p><strong>Custom Theme:</strong></p> <div class="minipress-highlight" data-lang="js"><pre class="minipress-highlight-code language-js"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">/* my theme implementation goes here */</span>
<span class="token punctuation">}</span></code></pre></div><p><strong>Theme Consumer:</strong></p> <div class="minipress-highlight" data-lang="js"><pre class="minipress-highlight-code language-js"><code class="language-js"><span class="token keyword">const</span> CustomTheme <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'my-custom-theme'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  theme<span class="token punctuation">:</span> CustomTheme
<span class="token punctuation">}</span></code></pre></div><p>However, this has one big disadvantage: <em>miniPress</em> no longer knows the location of <code>CustomTheme</code> in the file system. This means that it cannot apply certain conventions for example automatically registering components found in <code>components/</code>. Probably that is why <em>VuePress</em> requires you to specify plugins by name. It is also possible to pass <em>VuePress</em> a function as a plugin but I have no idea how they do it.</p> <h2 id="asyncdata"><a href="/minipress/internals#asyncdata" aria-hidden="true" class="header-anchor">#</a> asyncData</h2> <p>Two things:</p> <ol><li>First, I will describe how nuxt supports <code>asyncData</code> and then</li> <li>I will describe how it works in miniPress</li></ol> <p>Let’s assume you have a page that looks like this:</p> <div class="minipress-highlight" data-lang="markup"><pre class="minipress-highlight-code language-markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{firstname}} – {{lastname}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> fetchLastName <span class="token keyword">from</span> <span class="token string">'./fetch-last-name'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">data</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>firstName<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">asyncData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// &lt; returns a promise that resolves to:</span>
    <span class="token comment">// { lastName: 'Borg' } (or some other last name)</span>
    <span class="token keyword">return</span> <span class="token function">fetchLastName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></code></pre></div><p>Now the user navigates to this page. Then <code>asyncData</code> is called on the server side and not again on the client. <code>asyncData</code> is called on the client for every page visited after the first one. The intention is probably to have a fast first page load and then the client takes over the control of <code>asyncData</code> for all subsequent site naviations.</p> <p>Note: Executing <code>nuxt generate</code> causes <code>asyncData</code> to be executed for each page (that does not have a dynamic route). Each <code>asyncData</code> is made part of the corresponding page bundle. But this bundled <code>asyncData</code> is only used for the initial page load (even for statically built sites). This may be what I want – or it may not be what I want. Where it breaks down is in cases where <code>asyncData</code> truly returns “static” data.</p> <p>This is how <code>asyncData</code> looks in miniPress:</p> <div class="minipress-highlight" data-lang="markup"><pre class="minipress-highlight-code language-markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{firstname}} – {{lastname}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> fetchLastName <span class="token keyword">from</span> <span class="token string">'./fetch-last-name'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">data</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>firstName<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function">asyncData</span><span class="token punctuation">(</span><span class="token parameter">asyncDataSSR</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>asyncDataSSR<span class="token punctuation">.</span>lastName <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> asyncDataSSR
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">fetchLastName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></code></pre></div><p><em>miniPress</em> calls <code>asyncData</code> twice. ALWAYS. Once on the server and the again on the client. The <code>asyncDataSSR</code> argument contains a copy of what has been generated during SSR. This can be <code>{}</code> in case <code>asyncData</code> is currently executed on the server. In other cases it is just whatever <code>asyncData</code> returned during SSR. This allows you to check the contents of <code>asyncDataSSR</code>. In the case above I check whether or not it contains a <code>lastName</code>. If it does <code>asyncDataSSR</code> is good enough for my use case and I simply return <code>asyncDataSSR</code>. If it does not contain <code>lastName</code> I am fetching the last name from the backend.</p> <ul><li>During Development miniPress initially sets <code>asyncDataSSR</code> to <code>{}</code> (when not disabled with <code>--keep-cache</code>) for every page. <code>asyncData</code> is called lazily – once you visit the corresponding page.</li> <li>When building a static version of the site <code>asyncData</code> is invoked for each page and also bundled with each page so that subsequent invokations come with the <code>asyncDataSSR</code> argument.</li></ul></div></div></div></div></div></div></div></div>
    <script src="/minipress/assets/js/app.js" defer></script><script src="/minipress/assets/js/13.js" defer></script>
  </body>
  </html>